<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>b-car: Speed</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">b-car
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">Speed</div>  </div>
</div><!--header-->
<div class="contents">

<p>If defined more functions are added to rainbow mode.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:speed_8ino"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="speed_8ino.html">speed.ino</a></td></tr>
<tr class="memdesc:speed_8ino"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measure speed. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga984097794e94beb18c01b6fcbd8f399d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga984097794e94beb18c01b6fcbd8f399d">INTERRUPTPIN</a>&#160;&#160;&#160;PCINT1</td></tr>
<tr class="memdesc:ga984097794e94beb18c01b6fcbd8f399d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is PB1 per the schematic.  <a href="#ga984097794e94beb18c01b6fcbd8f399d">More...</a><br /></td></tr>
<tr class="separator:ga984097794e94beb18c01b6fcbd8f399d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga77b45027297b1ff40b5b1249afb852e5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga77b45027297b1ff40b5b1249afb852e5">PCINT_VECTOR</a>&#160;&#160;&#160;PCINT0_vect</td></tr>
<tr class="separator:ga77b45027297b1ff40b5b1249afb852e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9142f4c677315955ad0ac6266b615d2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga9142f4c677315955ad0ac6266b615d2c">DATADIRECTIONPIN</a>&#160;&#160;&#160;DDB1</td></tr>
<tr class="separator:ga9142f4c677315955ad0ac6266b615d2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaab113cddfa5f8856918dcb65238882ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gaab113cddfa5f8856918dcb65238882ca">PORTPIN</a>&#160;&#160;&#160;PB1</td></tr>
<tr class="separator:gaab113cddfa5f8856918dcb65238882ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga93a1139e66a97ca289f0f1a73903be06"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga93a1139e66a97ca289f0f1a73903be06">READPIN</a>&#160;&#160;&#160;PINB1</td></tr>
<tr class="separator:ga93a1139e66a97ca289f0f1a73903be06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga605bafc427aaa8e9718a112441ba88a7"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga605bafc427aaa8e9718a112441ba88a7">speedts</a></td></tr>
<tr class="separator:ga605bafc427aaa8e9718a112441ba88a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga66ce79a1ea6b700d56211c146f679649"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga66ce79a1ea6b700d56211c146f679649">braketime</a></td></tr>
<tr class="separator:ga66ce79a1ea6b700d56211c146f679649"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga63232e097931bc02aa65b3b7dadbb74b"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga63232e097931bc02aa65b3b7dadbb74b">curspeed</a></td></tr>
<tr class="separator:ga63232e097931bc02aa65b3b7dadbb74b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad13fd9ed7295daa9a51dd2fade080e50"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gad13fd9ed7295daa9a51dd2fade080e50">isbraking</a></td></tr>
<tr class="separator:gad13fd9ed7295daa9a51dd2fade080e50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae87a94769934715c309733cfdf2abcb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gae87a94769934715c309733cfdf2abcb4">setup_interrupt</a> ()</td></tr>
<tr class="separator:gae87a94769934715c309733cfdf2abcb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga44395845abd4a9c31e4fbe88ed717fa3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga44395845abd4a9c31e4fbe88ed717fa3">ISR</a> (<a class="el" href="group__speed.html#ga77b45027297b1ff40b5b1249afb852e5">PCINT_VECTOR</a>)</td></tr>
<tr class="separator:ga44395845abd4a9c31e4fbe88ed717fa3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafc7b1718f9b23966dfed24056f67996f"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gafc7b1718f9b23966dfed24056f67996f">getspeed</a> ()</td></tr>
<tr class="memdesc:gafc7b1718f9b23966dfed24056f67996f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current speed.  <a href="#gafc7b1718f9b23966dfed24056f67996f">More...</a><br /></td></tr>
<tr class="separator:gafc7b1718f9b23966dfed24056f67996f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa41dbc9d264f533090ac3c808c43171f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gaa41dbc9d264f533090ac3c808c43171f">acceleration</a> (unsigned int newspeed)</td></tr>
<tr class="memdesc:gaa41dbc9d264f533090ac3c808c43171f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test for negative accelaration (braking)  <a href="#gaa41dbc9d264f533090ac3c808c43171f">More...</a><br /></td></tr>
<tr class="separator:gaa41dbc9d264f533090ac3c808c43171f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ad56507af5eec4c270def2058efbc3b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga3ad56507af5eec4c270def2058efbc3b">braking</a> ()</td></tr>
<tr class="memdesc:ga3ad56507af5eec4c270def2058efbc3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Braking information.  <a href="#ga3ad56507af5eec4c270def2058efbc3b">More...</a><br /></td></tr>
<tr class="separator:ga3ad56507af5eec4c270def2058efbc3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2004678343c1f7b145dc10aae949a4ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#ga2004678343c1f7b145dc10aae949a4ec">resetspeed</a> ()</td></tr>
<tr class="separator:ga2004678343c1f7b145dc10aae949a4ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa1b4f1cc5cf5ba94e3bc38f44e0c7001"><td class="memItemLeft" align="right" valign="top">byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__speed.html#gaa1b4f1cc5cf5ba94e3bc38f44e0c7001">getspeedidx</a> ()</td></tr>
<tr class="separator:gaa1b4f1cc5cf5ba94e3bc38f44e0c7001"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>If defined more functions are added to rainbow mode. </p>
<p>Measure speed by interrupts. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga9142f4c677315955ad0ac6266b615d2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DATADIRECTIONPIN&#160;&#160;&#160;DDB1</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section see"><dt>See also</dt><dd>Page 64 of data sheet </dd></dl>

<p>Definition at line <a class="el" href="config_8h_source.html#l00140">140</a> of file <a class="el" href="config_8h_source.html">config.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga984097794e94beb18c01b6fcbd8f399d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INTERRUPTPIN&#160;&#160;&#160;PCINT1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is PB1 per the schematic. </p>

<p>Definition at line <a class="el" href="config_8h_source.html#l00138">138</a> of file <a class="el" href="config_8h_source.html">config.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga77b45027297b1ff40b5b1249afb852e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCINT_VECTOR&#160;&#160;&#160;PCINT0_vect</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section note"><dt>Note</dt><dd>This step is not necessary </dd></dl>

<p>Definition at line <a class="el" href="config_8h_source.html#l00139">139</a> of file <a class="el" href="config_8h_source.html">config.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaab113cddfa5f8856918dcb65238882ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PORTPIN&#160;&#160;&#160;PB1</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section see"><dt>See also</dt><dd>Page 64 </dd></dl>

<p>Definition at line <a class="el" href="config_8h_source.html#l00141">141</a> of file <a class="el" href="config_8h_source.html">config.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga93a1139e66a97ca289f0f1a73903be06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define READPIN&#160;&#160;&#160;PINB1</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section see"><dt>See also</dt><dd>Page 64 </dd></dl>

<p>Definition at line <a class="el" href="config_8h_source.html#l00142">142</a> of file <a class="el" href="config_8h_source.html">config.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa41dbc9d264f533090ac3c808c43171f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void acceleration </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>newspeed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test for negative accelaration (braking) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newspeed</td><td>current speed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00096">96</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="ga3ad56507af5eec4c270def2058efbc3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool braking </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Braking information. </p>
<p>Return true if car is braking. </p><dl class="section return"><dt>Returns</dt><dd>braking state. </dd></dl>

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00116">116</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="gafc7b1718f9b23966dfed24056f67996f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int getspeed </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get current speed. </p>
<p>The speed is measured as integral of interrupts in an interval of at least 256ms. The smallest measurable speed is one interrupt per 256ms. This function returns an unsigned integer, so the smallest value above 0 should be 1. To get this result the count of interrupts is bit shifted by 8.</p>
<p>1&lt;&lt;8 = 256; 256/256 = 1</p>
<p>But what does 1 represent?</p>
<p>I put 16 interrupt marks to tire of my Bobby Car. One interrupt every 250 ms are 15 rpm (revolutions per minute).</p>
<p>My Bobby Car has a tire diameter of about 153 mm. So the circumference is 478mm (d*pi).</p>
<p>478mm * 15 rpm = 0.4302 km/h</p>
<dl class="section return"><dt>Returns</dt><dd>current speed. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__speed.html#ga44395845abd4a9c31e4fbe88ed717fa3">ISR(PCINT_VECTOR)</a> </dd>
<dd>
<a class="el" href="car__basics_8h.html#ac7295d1018b2b948084ba5dbacf09d74" title="Display the current speed on tacho_row LEDs. ">tacho()</a> </dd></dl>

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00070">70</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="gaa1b4f1cc5cf5ba94e3bc38f44e0c7001"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">byte getspeedidx </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00129">129</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="ga44395845abd4a9c31e4fbe88ed717fa3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__speed.html#ga77b45027297b1ff40b5b1249afb852e5">PCINT_VECTOR</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00035">35</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="ga2004678343c1f7b145dc10aae949a4ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void resetspeed </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00121">121</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="gae87a94769934715c309733cfdf2abcb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_interrupt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00019">19</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga66ce79a1ea6b700d56211c146f679649"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long braketime</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00015">15</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="ga63232e097931bc02aa65b3b7dadbb74b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int curspeed</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00016">16</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="gad13fd9ed7295daa9a51dd2fade080e50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isbraking</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00017">17</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
<a class="anchor" id="ga605bafc427aaa8e9718a112441ba88a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long speedts</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="speed_8ino_source.html#l00014">14</a> of file <a class="el" href="speed_8ino_source.html">speed.ino</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
